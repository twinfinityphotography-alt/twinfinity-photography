<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deployment Test - Twinfinity Photography</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .pass { border-color: #4CAF50; background: #f1f8e9; }
        .fail { border-color: #f44336; background: #ffebee; }
        .warning { border-color: #ff9800; background: #fff3e0; }
        .test-title { font-weight: bold; margin-bottom: 10px; }
        .test-result { margin: 5px 0; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976D2; }
        .error { color: #f44336; }
        .success { color: #4CAF50; }
        .warning { color: #ff9800; }
    </style>
</head>
<body>
    <h1>🔧 Twinfinity Photography - Deployment Test</h1>
    <p>This page tests all the key functionality of your photography website. Run these tests after deployment to ensure everything works correctly.</p>

    <button onclick="runAllTests()">🚀 Run All Tests</button>
    <button onclick="testFirebaseConnection()">Test Firebase</button>
    <button onclick="testCloudinaryConnection()">Test Cloudinary</button>

    <div id="test-results">
        <!-- Test results will appear here -->
    </div>

    <div class="test-section">
        <div class="test-title">📋 Manual Testing Checklist</div>
        <p>After automated tests pass, manually verify these items:</p>
        <ul>
            <li>✅ Main website loads correctly at <code>index.html</code></li>
            <li>✅ Admin dashboard loads at <code>admin.html</code></li>
            <li>✅ Can log in to admin with credentials: <code>admin@gmail.com</code> / <code>admin123</code></li>
            <li>✅ Admin can upload profile photo</li>
            <li>✅ Admin can create categories</li>
            <li>✅ Admin can upload images to galleries</li>
            <li>✅ Changes in admin dashboard appear on main website immediately</li>
            <li>✅ Booking form saves to Firebase and opens WhatsApp</li>
            <li>✅ All buttons and navigation work</li>
            <li>✅ Website is responsive on mobile devices</li>
        </ul>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCAmMqSfWvPXoFQnmKdiM2lf9A3ik1W2sI",
            authDomain: "twinfinityphotography-eea27.firebaseapp.com",
            projectId: "twinfinityphotography-eea27",
            storageBucket: "twinfinityphotography-eea27.firebasestorage.app",
            messagingSenderId: "264522763978",
            appId: "1:264522763978:web:d46ffb2adc64834095ae33",
            measurementId: "G-5NLLKF6E24"
        };

        const CLOUDINARY_CONFIG = {
            cloudName: 'dmodvacdz',
            uploadPreset: 'twinfinity_photos'
        };

        let app, db, auth;
        let testResults = [];

        function addTestResult(title, status, message) {
            testResults.push({ title, status, message });
            displayResults();
        }

        function displayResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = testResults.map(result => `
                <div class="test-section ${result.status}">
                    <div class="test-title">${result.title}</div>
                    <div class="test-result ${result.status === 'pass' ? 'success' : result.status === 'fail' ? 'error' : 'warning'}">
                        ${result.message}
                    </div>
                </div>
            `).join('');
        }

        async function testFirebaseConnection() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                addTestResult('🔥 Firebase Initialization', 'pass', 'Firebase SDK loaded successfully');

                // Test Firestore connection
                const testDoc = await getDoc(doc(db, 'settings', 'site'));
                if (testDoc.exists()) {
                    addTestResult('📄 Firestore Connection', 'pass', 'Successfully connected to Firestore database');
                } else {
                    addTestResult('📄 Firestore Connection', 'warning', 'Connected to Firestore but no settings document found');
                }

                addTestResult('🔐 Firebase Auth', 'pass', 'Firebase Authentication initialized');
                
            } catch (error) {
                addTestResult('🔥 Firebase Connection', 'fail', `Firebase error: ${error.message}`);
            }
        }

        async function testCloudinaryConnection() {
            try {
                const testUrl = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CONFIG.cloudName}/image/list`;
                const response = await fetch(testUrl, {
                    method: 'HEAD'
                });
                
                if (response.ok || response.status === 401) { // 401 is expected without API key
                    addTestResult('☁️ Cloudinary Connection', 'pass', 'Cloudinary API endpoint is accessible');
                } else {
                    addTestResult('☁️ Cloudinary Connection', 'fail', `Cloudinary not accessible: ${response.status}`);
                }
            } catch (error) {
                addTestResult('☁️ Cloudinary Connection', 'fail', `Cloudinary error: ${error.message}`);
            }
        }

        function testFileStructure() {
            const requiredFiles = [
                './index.html',
                './admin.html', 
                './styles.css',
                './admin-styles.css',
                './script.js',
                './admin-script.js',
                './firebase-config.js',
                './fallback-storage.js'
            ];

            let passCount = 0;
            const promises = requiredFiles.map(async (file) => {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        passCount++;
                        return `✅ ${file}`;
                    } else {
                        return `❌ ${file} (${response.status})`;
                    }
                } catch (error) {
                    return `❌ ${file} (${error.message})`;
                }
            });

            Promise.all(promises).then(results => {
                const status = passCount === requiredFiles.length ? 'pass' : 'fail';
                addTestResult('📁 File Structure', status, results.join('<br>'));
            });
        }

        function testExternalDependencies() {
            // Test Font Awesome
            const faTest = document.createElement('i');
            faTest.className = 'fas fa-test';
            faTest.style.position = 'absolute';
            faTest.style.left = '-9999px';
            document.body.appendChild(faTest);
            
            const faLoaded = window.getComputedStyle(faTest, ':before').fontFamily.includes('Font Awesome');
            document.body.removeChild(faTest);

            if (faLoaded) {
                addTestResult('🎨 Font Awesome', 'pass', 'Font Awesome icons loaded successfully');
            } else {
                addTestResult('🎨 Font Awesome', 'warning', 'Font Awesome may not be loaded correctly');
            }

            // Test Google Fonts
            const fontTest = document.createElement('div');
            fontTest.style.fontFamily = 'Inter, sans-serif';
            fontTest.style.position = 'absolute';
            fontTest.style.left = '-9999px';
            fontTest.textContent = 'Test';
            document.body.appendChild(fontTest);
            
            const interLoaded = window.getComputedStyle(fontTest).fontFamily.includes('Inter');
            document.body.removeChild(fontTest);

            if (interLoaded) {
                addTestResult('🔤 Google Fonts', 'pass', 'Inter font loaded successfully');
            } else {
                addTestResult('🔤 Google Fonts', 'warning', 'Inter font may not be loaded correctly');
            }
        }

        async function runAllTests() {
            testResults = [];
            addTestResult('🚀 Starting Tests', 'pass', 'Running comprehensive deployment tests...');
            
            testFileStructure();
            testExternalDependencies();
            await testFirebaseConnection();
            await testCloudinaryConnection();

            addTestResult('✨ Tests Complete', 'pass', 'All automated tests completed. Check manual checklist above.');
        }

        // Make functions globally available
        window.runAllTests = runAllTests;
        window.testFirebaseConnection = testFirebaseConnection;
        window.testCloudinaryConnection = testCloudinaryConnection;

        // Auto-run basic tests on load
        setTimeout(() => {
            testExternalDependencies();
        }, 1000);
    </script>
</body>
</html>